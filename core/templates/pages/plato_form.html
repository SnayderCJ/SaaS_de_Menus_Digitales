{% extends "layout/base.html" %}
{% block title %}{{ view.object.pk|default:"Nuevo Plato" }}{% endblock %}

{% block content %}
<div>
  <div class="max-w-2xl w-full bg-white rounded-3xl shadow-2xl px-14 py-12 mx-auto">
    <div class="flex flex-col items-center mb-10">
      <div class="w-20 h-20 flex items-center justify-center bg-purple-100 rounded-full mb-4 shadow">
        <svg class="w-12 h-12 text-purple-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
      </div>
      <h2 class="text-4xl font-black text-gray-900 text-center tracking-tight">
        {% if view.object %}Editar Plato{% else %}Nuevo Plato{% endif %}
      </h2>
      <p class="text-gray-500 text-center mt-2 text-lg">Completa los detalles del plato</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="space-y-8">
      {% csrf_token %}
      {% for field in form %}
        {% if field.name == "imagen" %}
          <div>
            <label class="block text-gray-700 text-base font-bold mb-2">{{ field.label }}</label>
            <div class="flex flex-col items-center gap-3">
              <label for="{{ field.id_for_label }}"
                class="cursor-pointer bg-purple-50 text-purple-700 px-6 py-3 rounded-2xl border-2 border-dashed border-purple-300 shadow-lg w-full flex items-center justify-center hover:bg-purple-200 hover:text-purple-900 transition text-base font-semibold relative">
                <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M16 8l-4-4-4 4m4-4v12"/>
                </svg>
                <span>
                  {% if view.object and view.object.imagen %}
                    Actualizar Imagen
                  {% else %}
                    Subir Imagen del Plato
                  {% endif %}
                </span>
                <input type="file" name="{{ field.name }}" id="{{ field.id_for_label }}" accept="image/*"
                  class="absolute left-0 top-0 w-full h-full opacity-0 cursor-pointer"/>
              </label>
              <div class="w-full flex justify-center">
                {% if view.object and view.object.imagen %}
                  <img src="{{ view.object.imagen.url }}" id="imagen-preview" alt="Imagen del plato" class="w-28 h-28 object-cover rounded-xl shadow border border-purple-200 mt-2">
                  <span class="block text-xs text-gray-400 mt-1">Imagen actual</span>
                {% else %}
                  <img id="imagen-preview" style="display:none" class="w-28 h-28 object-cover rounded-xl shadow border border-purple-200 mt-2">
                {% endif %}
              </div>
              {% for error in field.errors %}
                <p class="text-xs text-red-500">{{ error }}</p>
              {% endfor %}
            </div>
          </div>
        {% elif field.name == "disponible" %}
          <div class="flex items-center gap-3 mt-2">
            <label class="inline-flex items-center cursor-pointer select-none">
              <input type="checkbox" name="disponible" id="{{ field.id_for_label }}"
                {% if field.value %}checked{% endif %}
                class="appearance-none w-7 h-7 border-2 rounded-md border-purple-400 bg-white checked:bg-purple-500 checked:border-purple-600 transition-all duration-200 align-middle focus:ring-2 focus:ring-purple-400">
              <span class="ml-3 text-gray-700 text-base font-semibold">Disponible</span>
            </label>
            {% for error in field.errors %}
              <p class="text-xs text-red-500">{{ error }}</p>
            {% endfor %}
          </div>
        {% else %}
          <div>
            <label class="block text-gray-700 text-base font-bold mb-1">{{ field.label }}</label>
            {{ field }}
            {% for error in field.errors %}
              <p class="text-red-500 text-xs mt-1">{{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
      <div>
        <button type="submit"
          class="w-full flex items-center justify-center gap-3 bg-purple-500 hover:bg-purple-600 text-white font-black text-lg py-4 rounded-xl shadow-xl focus:outline-none focus:ring-2 focus:ring-purple-400 transition">
          <span>{% if view.object %}Guardar Cambios{% else %}Agregar Plato{% endif %}</span>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('id_imagen');
  if (!input) return;
  const preview = document.getElementById('imagen-preview');

  input.addEventListener('change', function(e) {
    const [file] = input.files;
    if (file) {
      preview.style.display = 'block';
      preview.src = URL.createObjectURL(file);
    } else {
      preview.style.display = 'none';
      preview.src = '';
    }
  });
});
</script>
{% endblock %}
