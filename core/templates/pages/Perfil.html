{% extends "layout/base.html" %}
{% block title %}Mi Perfil{% endblock %}

{% block content %}
<div class="min-h-screen w-full flex justify-center items-center bg-gradient-to-tr from-purple-100 via-white to-purple-200 py-12">
  <div class="w-full max-w-4xl md:px-0 px-2">
    <div class="flex flex-col items-center mb-8">
      <div class="bg-white shadow-lg p-1 rounded-full -mb-12 z-10">
        <svg class="w-24 h-24 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 20c0-3.5 4-6.5 8-6.5s8 3 8 6.5"/>
        </svg>
      </div>
      <h2 class="text-4xl font-black text-purple-700 mt-16 mb-1 text-center tracking-tight">Mi Perfil</h2>
      <p class="text-gray-500 mb-2 text-center max-w-md">Administra tus datos y personaliza tu restaurante</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="grid md:grid-cols-2 gap-8">
      {% csrf_token %}
      <!-- Tarjeta Usuario -->
      <div class="bg-white border border-purple-100 rounded-2xl shadow-lg p-8 flex flex-col gap-5 items-center">
        <h3 class="font-bold text-lg text-purple-600 flex items-center gap-2 mb-2">
          <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="8" r="4" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 20c0-3.5 4-6.5 8-6.5s8 3 8 6.5"/>
          </svg>
          Datos de usuario
        </h3>
        {% for field in user_form %}
          <div class="w-full">
            <label class="text-sm text-purple-900 font-semibold mb-1 block">{{ field.label }}</label>
            {{ field }}
            {% for error in field.errors %}
              <p class="text-xs text-red-500">{{ error }}</p>
            {% endfor %}
          </div>
        {% endfor %}
        <div class="pt-2 text-gray-400 text-xs w-full text-right">
          <span>Registrado: {{ request.user.date_joined|date:"d/m/Y" }}</span>
        </div>
      </div>

      <!-- Tarjeta Restaurante -->
      <div class="bg-white border border-purple-100 rounded-2xl shadow-lg p-8 flex flex-col gap-5 items-center">
        <h3 class="font-bold text-lg text-purple-600 flex items-center gap-2 mb-2">
          <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7h18M3 12h18M3 17h18" />
          </svg>
          Mi Restaurante
        </h3>
        {% for field in rest_form %}
          {% if field.name == "logo" %}
            <div class="w-full flex flex-col items-center gap-3">
              <label class="text-sm text-purple-900 font-semibold mb-1 block">{{ field.label }}</label>
              <label for="{{ field.id_for_label }}"
                class="cursor-pointer bg-purple-50 text-purple-700 px-6 py-3 rounded-2xl border-2 border-dashed border-purple-300 shadow-lg w-full flex items-center justify-center hover:bg-purple-200 hover:text-purple-900 transition text-base font-semibold relative">
                <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M16 8l-4-4-4 4m4-4v12"/>
                </svg>
                <span>
                  {% if restaurante.logo %}
                    Actualizar logo del restaurante
                  {% else %}
                    Subir logo del restaurante
                  {% endif %}
                </span>
                <input type="file" name="{{ field.name }}" id="{{ field.id_for_label }}" accept="image/*"
                  class="absolute left-0 top-0 w-full h-full opacity-0 cursor-pointer"/>
              </label>
              <div class="w-full flex justify-center">
                {% if restaurante.logo %}
                  <img src="{{ restaurante.logo.url }}" id="logo-preview" alt="Logo restaurante" class="w-24 h-24 object-cover rounded-full shadow border-2 border-purple-200 mt-2">
                  <span class="text-xs text-gray-400 mt-1 block text-center">Logo actual</span>
                {% else %}
                  <img id="logo-preview" style="display:none" class="w-24 h-24 object-cover rounded-full shadow border-2 border-purple-200 mt-2">
                {% endif %}
              </div>
              <span class="block text-xs text-gray-400 text-center">Tamaño recomendado: 400x400px • JPG o PNG</span>
              {% for error in field.errors %}
                <p class="text-xs text-red-500">{{ error }}</p>
              {% endfor %}
            </div>
          {% else %}
            <div class="w-full">
              <label class="text-sm text-purple-900 font-semibold mb-1 block">{{ field.label }}</label>
              {{ field }}
              {% for error in field.errors %}
                <p class="text-xs text-red-500">{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}
        {% if restaurante.qr_code %}
          <div class="mt-2 flex flex-col items-center w-full">
            <p class="text-xs text-gray-500 mb-1">Tu menú público (QR)</p>
            <img src="{{ restaurante.qr_code.url }}" alt="Código QR del menú" class="w-20 h-20 rounded-lg shadow border border-purple-300">
            <a href="{{ restaurante.qr_code.url }}" download class="block mt-1 text-purple-500 hover:text-purple-800 text-xs font-semibold underline">Descargar QR</a>
          </div>
        {% endif %}
      </div>

      <div class="md:col-span-2">
        <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 rounded-xl shadow-lg transition text-lg">
          Guardar Cambios
        </button>
      </div>
    </form>
    <div class="text-center mt-10">
      <a href="{% url 'dashboard' %}" class="text-purple-500 hover:text-purple-900 text-sm font-semibold underline">
        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
        Volver al Dashboard
      </a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('id_logo');
  if (!input) return;
  const preview = document.getElementById('logo-preview');
  input.addEventListener('change', function() {
    const [file] = input.files;
    if (file) {
      preview.style.display = 'block';
      preview.src = URL.createObjectURL(file);
    } else {
      preview.style.display = 'none';
      preview.src = '';
    }
  });
});
</script>
{% endblock %}
